{{#admin_group_admin}}

<style>
.php1{position:relative;left:+0.1em}
.php2{position:relative;left:+0.0em}
.php3{position:relative;left:-0.1em}
.summernote{border:2px dashed #ccc;padding:1rem!important}
.summernote::before{content:"📝";position:relative;top:-3rem;left:-1rem}
.btnmargin{margin:2px;margin-bottom:5px}
.bigemoji{font-size:5em}
.faces::after{content:"🌸";animation-name:faces;animation-duration:1s}
.emojianim::after{animation-timing-function:linear;animation-iteration-count:infinite}
@keyframes faces{10%{content:"🌼"}20%{content:"🌳"}30%{content:"🌺"}40%{content:"🌵"}50%{content:"🌶"}60%{content:"🍇"}70%{content:"🍄"}80%{content:"🍓"}90%{content:"🌽"}}
.a_reset{font-family:Arial!important;font-size:14px!important}.a_h2{font-size:5em!important;font-weight:700!important}.a_h4{font-size:3em!important;font-weight:700!important}.a_h5{font-size:2em!important;font-weight:700!important}
.extrapadding{padding:5px;border-radius:5px}
.nowrap{white-space:nowrap}
.protect{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:inline-block;width:10em;line-height:12px}
#admin_main .row{margin-bottom:5px}
#admin_main {padding-top:5px}
#admin_main,#admin_main h2,#admin_main h4,#admin_main h5{font-family:Arial!important}
#admin_main {font-size:14px!important}
#a_rotate_device{display:none}
[touch="true"] #a_rotate_device{display:block}
#emojis{cursor:crosshair}
/* Summernote plugins */
.panel-heading.note-toolbar .note-font .dropdown-menu,.panel-heading.note-toolbar .note-style .dropdown-menu{min-width:245px;padding:5px}
.panel-heading.note-toolbar .note-font .dropdown-menu>div:first-child,.panel-heading.note-toolbar .note-style .dropdown-menu>div:first-child{margin-right:5px}
.note-add-text-tags-btn{font-family:"Times New Roman",serif;min-width:30px}
</style>

<!-- butterfly -->
<span style="position:fixed;left:0;top:0;z-index:999999" class="motyle btn white hide-on-med-and-down">🦋</span>
<span style="position:fixed;right:0;top:0;z-index:999999" class="motyle btn white hide-on-large-only">🦋</span>

<div id="admin_main" class="row center black white-text" style="display:none;margin:0!important">
  <!-- device rotation -->
  <div id="a_rotate_device" class="row center" style="padding-top:3px">
    {{ l.a_rotate_device }}
  </div>

  {{>admin_custom}}

  <!-- external services buttons -->
  <div class="row center black hide-on-small-only">
    <div class="extrapadding hide-on-small-only" style="padding-top:3px">
      <a style="margin:2px;" class="tooltipped waves-effect teal waves-light btn" target="_blank" rel="noopener"
        data-position="top" data-tooltip="{{ l.a_google_account_ttip }}" href="https://myaccount.google.com/dashboard">
        <i class="fab fa-google"></i>
        {{ l.a_google_account }}</a>
      <a style="margin:2px;" class="tooltipped waves-effect teal waves-light btn" target="_blank" rel="noopener"
        data-position="top" data-tooltip="{{ l.a_google_password_ttip }}" href="https://passwords.google.com">
        <i class="fab fa-google"></i>
        {{ l.a_google_password }}</a>
      <a style="margin:2px;" class="tooltipped waves-effect teal waves-light btn" target="_blank" rel="noopener"
        data-position="top" data-tooltip="{{ l.a_google_search_ttip }}"
        href="https://search.google.com/search-console?resource_id={{ canonical_url }}">
        <i class="fab fa-google"></i>
        {{ l.a_google_search }}</a>
      <a style="margin:2px;" class="tooltipped waves-effect teal waves-light btn" target="_blank" rel="noopener"
        data-position="top" data-tooltip="{{ l.a_google_analytics_ttip }}"
        href="{{#google.analytics}}{{ google.analytics }}{{/google.analytics}}{{^google.analytics}}https://analytics.google.com/analytics/web/{{/google.analytics}}">
        <i class="fab fa-google"></i>
        {{ l.a_google_analytics }}</a>
      <a style="margin:2px;" class="tooltipped waves-effect lime waves-light btn" target="_blank" rel="noopener"
        data-position="top" data-tooltip="{{ l.a_onesignal_ttip }}" href="https://app.onesignal.com/login">
        <i class="fas fa-bell"></i>
        {{ l.a_onesignal }}</a>
    </div>

    <!-- external links -->
    {{#external_links}}
      <a rel="noreferrer noopener" target="_blank" class="tooltipped green white-text"
        data-position="top" data-tooltip="{{ title }}" href="{{ link }}"><b>&nbsp;{{ name }}&nbsp;</b></a>&nbsp;&nbsp;
    {{/external_links}}
  </div>

  <!-- admin grid -->
  <div class="row grid" style="overflow:hidden" style="padding-top:3px">

    <!-- DATA -->
    <div class="col l4 m6 s12">
      <div class="row center extrapadding">
        <h5>{{ l.a_locales }}&nbsp;<span id="csv_ping" class="mono">&nbsp;</span></h5>
        <p id="a_update_info"></p>
        <div class="col s12 white">
          <label>{{ l.a_sites }}</label>
          <select id="SiteSelect">
            <option value="" disabled selected>&hellip;</option>
            {{#multisite_names}}
            <option value="{{.}}">{{.}}</option>
            {{/multisite_names}}
          </select>
        </div>
        <div id="domains" style="font-size:12px!important;color:#888!important" class="container"></div>
        <a id="a_emoji" style="margin:5px" class="waves-effect blue waves btn faces emojianim"></a>
        <a id="a_summernote" style="margin:5px" class="tooltipped waves-effect green waves-light btn"
          data-position="top" data-tooltip="{{ l.a_summernote_ttip }}">
          <i class="fas fa-edit"></i>
          {{ l.a_summernote }}</a>&nbsp;<span id="summer_ping" class="mono">&nbsp;</span>
      </div>
    </div>

    <!-- CACHE -->
    <div class="col l4 m6 s12">
      <div class="row center extrapadding">
        <h5>{{ l.a_cache }}</h5>
        <div class="container">
          <span class="nowrap">default: <b>{{ cache_profiles.default }}</b></span>&nbsp;
          <span class="nowrap">CSV: <b>{{ cache_profiles.csv }}</b></span>&nbsp;
          <span class="nowrap">{{ l.a_limiter }}: <b>{{ CONST.LIMITER_MAXIMUM }}x</b> / <b>{{ cache_profiles.limiter }}</b></span>&nbsp;
          <span class="nowrap">{{ l.a_webpage }}: <b>{{ cache_profiles.page }}</b></span>
        </div>
        <div class="row center">
          <a id="a_update" style="margin:5px;" class="tooltipped waves-effect green waves-light btn"
            data-position="top" data-tooltip="{{ l.a_update_ttip }}">
            <i class="fab fa-google-drive"></i>
            {{ l.a_update }}</a>
          <a id="a_flush" style="margin:5px;" class="tooltipped waves-effect green waves-light btn"
            data-position="top" data-tooltip="{{ l.a_flush_ttip }}">
            <i class="fas fa-cloud-sun"></i>
            {{ l.a_flush }}</a>
          <a href="/admin/clearbrowserdata" style="margin:5px;" class="tooltipped waves-effect red waves-light btn"
            data-position="top" data-tooltip="{{ l.a_clear_browser_ttip }}">
            <i class="fas fa-power-off"></i>
            {{ l.a_clear_browser }}</a>
        </div>
      </div>
      <div class="row center white hide-on-small-only">
        <div class="col s12 white">
          <label>{{ l.a_remotefns }}</label>
          <select id="RemoteFnSelect">
            <option value="" disabled selected>&hellip;</option>
            <option value="CoreUpdateRemote">Core Data Update</option>
            <option value="FlushCacheRemote">Flush Local Cache</option>
            <option value="RebuildNonceRemote">Rebuild Auth Nonce</option>
            <option value="RebuildSecureKeyRemote">Rebuild Cookie Secure Key</option>
            <option value="RebuildAdminKeyRemote">Rebuild Administration Secure Key</option>
          </select>
        </div>
      </div>
    </div>

    <!-- PERMISSIONS -->
    <div class="col l4 m6 s12">
      <div class="row center extrapadding">
        <div class="white-text">
          <h5>{{ l.a_groups_permissions }}</h5>
          <div class="row center hide-on-small-only">
            <strong>ADMIN</strong>
            <div class="container">
              <p class="orange-text">
                {{#admin_groups.admin}}{{ . }} {{/admin_groups.admin}}
                {{^admin_groups.admin}}<i class="red-text fas fa-times"></i>{{/admin_groups.admin}}
              </p>
            </div>
            <strong>DEFAULT</strong>
            <div class="container">
              <p class="orange-text">
                {{#admin_groups.default}}{{ . }} {{/admin_groups.default}}
                {{^admin_groups.default}}<i class="red-text fas fa-times"></i>{{/admin_groups.default}}
              </p>
            </div>
          </div>
          <div class="row center">
            <strong>{{user.name}}</strong><br>
            <i style="font-size:smaller">{{user.email}}</i><br>
            <a id="a_getcode" class="btnmargin xtooltipped waves-effect blue waves-light btn"
              data-position="top" data-tooltip="">📲</a>
            <a id="a_delcode" class="btnmargin xtooltipped waves-effect red waves-light btn"
              data-position="top" data-tooltip="">📴</a>
            <br>
            <a id="a_logout" class="tooltipped waves-effect green waves-light btn"
              data-position="top" data-tooltip="{{ l.a_logout_ttip }}">
              <i class="fas fa-sign-out-alt"></i>
              {{ l.a_logout }}</a>
            <a target="_blank" ref="nofollow" href="/admin/AuditLog" class="waves-effect blue waves-light btn">
              <i class="fas fa-list"></i></a>
          </div>
        </div>
      </div>
    </div>

    <!-- Google -->
    <div class="col l4 m6 s12">
      <div class="row center extrapadding hide-on-small-only">
        <div class="white-text">
          <h5>{{ l.a_google }}</h5>
          <ul class="mono">
            <li>GCP id: {{ gcp_project_id }}
              {{^gcp_project_id}}<i class="red-text fas fa-times"></i>{{/gcp_project_id}}</li>
            <li>Google Maps Query: {{ google.map_query }}
              {{^google.map_query}}<i class="red-text fas fa-times"></i>{{/google.map_query}}</li>
            <li>Google Analytics: {{ google.ua }}
              {{^google.ua}}<i class="red-text fas fa-times"></i>{{/google.ua}}</li>
            <li>Google Maps API key: <span title="{{ google.mapsapi_key }}"
                class="protect">{{ google.mapsapi_key }}</span>
              {{^google.mapsapi_key}}<i class="red-text fas fa-times"></i>{{/google.mapsapi_key}}</li>
            <li>PageSpeed Insights API key: <span title="{{ google.pagespeedinsights_key }}" class="protect">{{
            google.pagespeedinsights_key }}</span>
              {{^google.pagespeedinsights_key}}<i class="red-text fas fa-times"></i>{{/google.pagespeedinsights_key}}
            </li>
          </ul>
          {{^l.onesignal_appid}}
          <div class="row center red-text" style="margin-top:1em">
            <div class="container">
              {{#convert_hyperlinks}}{{ l.a_onesignal_missing }}{{/convert_hyperlinks}}
            </div>
          </div>
          {{/l.onesignal_appid}}
        </div>
      </div>
    </div>

    <!-- CHANGELOG -->
    <div class="col l4 m6 hide-on-small-only">
      <div class="row center extrapadding">
        <h5>{{ l.a_changes }}</h5>
        <div class="row grey-text" style="margin-top:1em">
          <div class="grey-text left-align container">
            {{ l.a_changelog }}
          </div>
        </div>
      </div>
    </div>

    <!-- PageSpeed Insights -->
    <div class="col l4 m6 hide-on-small-only">
      <div class="row center extrapadding">
        <h5>{{ l.a_optimizations }}&nbsp;<span id="psi_ping" class="mono">&nbsp;</span></h5>
        <p id="a_ps_insights_info"></p>
        <div id="psi_row" class="row center">
          <a id="a_ps_insights" class="tooltipped waves-effect green waves-light btn" data-position="top"
            data-tooltip="{{ l.a_ps_insights_ttip }}">
            <i class="fab fa-google"></i>
            {{ l.a_ps_insights }}</a>
        </div>
      </div>

      <!-- icon buttons -->
      <h4 class="center">
        <a rel="noreferrer noopener" target="_blank" class="tooltipped blue-text text" data-position="top"
          data-tooltip="{{ l.a_github_ttip }}" href="https://github.com/gscloud"><i class="fab fa-git"></i></a>
        <a rel="noreferrer noopener" target="_blank" class="tooltipped orange-text text" data-position="top"
          data-tooltip="{{ l.a_sysinfo_ttip }}" href="https://sys.gscloud.cz/index.php?disp=bootstrap">
          <i class="fas fa-server"></i></a>
        <a rel="noreferrer noopener" target="_blank" class="tooltipped red-text text"
          data-position="top" data-tooltip="{{ l.a_lasagna_manual_ttip }}" href="{{ l.a_lasagna_manual_url }}">
          <i class="fas fa-dna"></i></a>
        <a rel="noreferrer noopener" target="_blank" class="tooltipped white-text text" data-position="top"
          data-tooltip="{{ l.a_locale_template_ttip }}" href="{{ l.a_locale_template_url }}">
          <i class="fas fa-clone"></i></a>
        <a rel="noreferrer noopener" target="_blank" class="tooltipped blue-text text" data-position="top"
          data-tooltip="{{ l.a_php_ttip }}" href="https://php.gscloud.cz" style="font-size:0.8em">
          <span class="php1">p</span><span class="php2">h</span><span class="php3">p</span></a>
        {{#google_drive_backup}}
        <a rel="noreferrer noopener" target="_blank" class="tooltipped brown-text text" data-position="top"
          data-tooltip="{{ l.a_google_backup_ttip }}" href="{{ google_drive_backup }}">
          <i class="fas fa-warehouse"></i></a>
        {{/google_drive_backup}}
      </h4>
    </div>

  </div>

  <!-- emojis -->
  <div id="emojis" class="row center" style="display:none">{{>emoji}}</div>
</div>

<script>
  (function (w, d, undefined) {
    if (getCookie("logout")) {
      d.getElementById("admin_main").style.display = "none";
      setCookie("motyle", "true");
    }
    delCookie("logout");

    if (w.GSC.init) {
      w.GSC.data = {};
      w.GSC.profile = "default";
      w.GSC.data.multisite_profiles = {{ multisite_profiles_json }};

      // ShowLoader()
      if (!w.GSC.ShowLoader) w.GSC.ShowLoader = function (t) {
        if (!t) return;
        $(t).html(
          '<div class="preloader-wrapper small active"><div class="spinner-layer spinner-blue-only"><div class="circle-clipper left"><div class=circle></div></div><div class=gap-patch><div class=circle></div></div><div class="circle-clipper right"><div class=circle></div></div></div></div>'
        );
      }

      // PingDot()
      if (!w.GSC.PingDot) w.GSC.PingDot = function (dot, status = true) {
        if (!dot) return;
        if (status) {
          status = "green";
        } else {
          status = "red";
        }
        $(dot).html("&#8226;").css({
          color: status,
          opacity: 1
        }).fadeTo("slow", 0);
      }

      // GetCsvInfo()
      if (!w.GSC.GetCsvInfo) w.GSC.GetCsvInfo = function () {
        if (w.GSC.offline) { // offline
          return GSC.PingDot("#csv_ping", false);
        }

        // API: GetCsvInfo
        $.get("/admin/GetCsvInfo?" + Date.now(), function (data) {
            GSC.PingDot("#csv_ping");
            var content = "";
            var now = ~~(Date.now() / 1000);
            for (x in data.data) {
              var link = x;
              var sheet = data.data[x]["sheet"];
              var csv = data.data[x]["csv"];
              var lines = data.data[x]["lines"];
              if (sheet) {
                link =
                  '<a rel=noopener target=_blank title="{{ l.a_edit_gsheet_ttip }}" style="border-radius:2px" ' +
                  'class="orange mono white-text bold" href="' +
                  'https://docs.google.com/spreadsheets/d/' +
                  sheet + '/edit#gid=0">&nbsp;<i class="material-icons white-text tiny">edit</i>&#8239;' +
                  x + '&nbsp;</a>&nbsp;&nbsp;&nbsp;<a rel=noopener target=_blank title="{{ l.a_download_csv_ttip }}"' +
                  ' style="border-radius:2px" class="bold blue white-text mono" ' +
                  'href="https://docs.google.com/spreadsheets/d/e/' +
                  csv + '/pub?output=csv">&nbsp;<i class="fas white-text fa-cloud-download-alt"></i>&#8239;' +
                  lines + '&nbsp;</a>&nbsp;';
              }
              moment.locale("{{ lang }}");
              content += (link + " {{ l.a_age }}&nbsp;" +
                moment.duration(Math.abs(~~((now - data.data[x]["timestamp"]))), "seconds").humanize() + "<br>"
              );
            }
            $("#a_update_info").html(content);
          })
          .fail(function () {
            GSC.PingDot("#csv_ping", false);
            $("#a_update_info").addClass("bigemoji").html('🤯');
          });
      }

      // GetPSInsights()
      if (!w.GSC.GetPSInsights) w.GSC.GetPSInsights = function () {
        if (GSC.offline) { // offline
          M.toast({html: "offline 📶"});
          return GSC.PingDot("#psi_ping", false);
        }
        var t = "#a_ps_insights_info";
        GSC.ShowLoader(t);

        // API: GetPSInsights
        $.get("/admin/GetPSInsights?" + Date.now(), function (data) {
            GSC.PingDot("#psi_ping");
            $("#psi_row").hide();
            if (data.data && data.data.lighthouseResult) {
              $(t).html('<h2 class="orange-text a_reset a_h2">' + data.data.lighthouseResult.categories.performance.score * 100 + "&nbsp;%</h2>");
              $(t).append("Lighthouse version:&nbsp;<span class=bold>" + data.data.lighthouseResult.lighthouseVersion + "</span><br> ");
              $(t).append("Total timing:&nbsp;<span class=bold>" + data.data.lighthouseResult.timing.total + "&nbsp;msec.</span> ");
              $(t).slideDown();
            } else {
              $(t).html('GetPSInsights ERROR 🤯').slideDown();
            }
            $("#a_ps_insights").removeAttr("disabled");
          })
          .fail(function () {
            GSC.PingDot("#psi_ping", false);
            $(t).html('GetPSInsights ERROR 🤯').slideDown();
            $("#a_ps_insights").removeAttr("disabled");
          });
      }

      // GSC.AdminUI()
      if (!w.GSC.AdminUI) w.GSC.AdminUI = function () {
        $("#admin_main div").addClass("a_reset");
        $("#admin_main h2").addClass("a_reset a_h2");
        $("#admin_main h4").addClass("a_reset a_h4");
        $("#admin_main h5").addClass("a_reset a_h5");
        $("#admin_main p").addClass("a_reset");

        // remove tooltips for touch display
        if (w.GSC.touch) {
          if ($(".tooltipped")) $(".tooltipped").tooltip("destroy");
        }

        // editor block doubleclick
        $(".summernote").dblclick(function () {
          $(".summernote").unbind("dblclick");
          GSC.DeploySummernote();
        });
      }

      // GSC.DeploySummernote()
      if (!w.GSC.DeploySummernote) w.GSC.DeploySummernote = function () {
        GSC.summernote_on = true;
        $("#a_summernote").attr("disabled", "disabled");
        $("#a_summernote").text("{{ l.a_save_all }}");
        $("#a_summernote").unbind("click");

        // save all
        $("#a_summernote").click(function () {
          if (GSC.offline) { // offline
            M.toast({html: "offline 📶"});
            return GSC.PingDot("#summer_ping", false);
          }
          $("#a_summernote").attr("disabled", "disabled");
          var id;
          var data = {};
          $(".summernote").each(function (i, obj) { // collect HTML data
            id = $(obj).attr("id");
            if (id) {
              data[id] = $(obj).summernote("code");
            }
            $(obj).summernote("destroy");
          });

          // API: UpdateArticles
          $.post("/admin/UpdateArticles", {
            profile: GSC.profile,
            hash: "{{ request_path_hash }}",
            data: JSON.stringify(data)
          }, function (data) {
            console.log("UpdateArticles result",{data});
          }).done(function() {
            GSC.PingDot("#summer_ping");
            $("#a_summernote").removeAttr("disabled");
            GSC.AdminUI();
            $("#a_summernote").html('<i class="fas fa-edit"></i>{{ l.a_summernote }}');
            $("#a_summernote").unbind("click");

            $("#a_summernote").click(function () {
              GSC.ReadArticles(function () {
                GSC.DeploySummernote();
              });
            });
            GSC.summernote_on = false;
          }).fail(function() {
            $("#a_summernote").removeAttr("disabled");
            GSC.PingDot("#summer_ping", false);
            M.toast({html: "ERROR 🤯"});
          });
        });

        // SaveAll button function
        var SaveAllButton = function (context) {
          var ui = $.summernote.ui;
          var button = ui.button({
            contents: '<i class="fas fa-save"></i> {{ l.a_save }}',
            click: function (e) {
              $("#a_summernote").click();
            }
          });
          return button.render();
        }

        // Summernote configuration
        $(".summernote").summernote({
          codeviewFilter: true,
          codeviewIframeFilter: true,
          dialogsInBody: false,
          disableDragAndDrop: true,
          height: 200,
          lang: '{{#langcs}}cs-CZ{{/langcs}}{{#langen}}en-US{{/langen}}',
          maximumImageFileSize: 1024*1024*4,
          placeholder: '{{#langcs}}Vítejte v editoru Summernote!{{/langcs}}{{#langen}}Welcome to Summernote editor!{{/langen}}',
          callbacks: {
            onChange: function(contents, $editable) {
              $('div.note-btn-group.note-custom>button>i.fa-save').css('color', 'red');
            }
          },
          tableClassName: 'table table-bordered striped highlight responsive-table',
          styleTags: [
            'p', 'blockquote', 'pre', 'h2', 'h3', 'h4', 'h5', 'h6'
          ],
          fontSizes: [
            '6', '7', '8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '30', '36', '42', '48', '55', '64', '82', '100', '130', '160', '200'
          ],
          toolbar: [
            ['style', ['style', 'add-text-tags', 'addclass']],
            ['font', ['bold', 'italic', 'underline', 'fontsize', 'fontname', 'strikethrough', 'superscript', 'subscript', 'clear']],
            ['color', ['forecolor', 'backcolor', 'color']],
            ['paragraph', ['ul', 'ol', 'paragraph', 'height']],
            ['table', ['table']],
            ['insert', ['link', 'picture', 'video']],
            ['history', ['undo', 'redo']],
            ['view', ['codeview', 'fullscreen']],
            ['custom', ['saveall']],
          ],
          buttons: {
            saveall: SaveAllButton
          }
        });
        $("#a_summernote").removeAttr("disabled");
      }

      // Summernote plugins
      w.GSC.init.push(function () {
        w.GSC.names.push("Summernote plugins");
        // custom styles
        (function(d){"function"===typeof define&&define.amd?define(["jquery"],d):"object"===typeof module&&module.exports?module.exports=d(require("jquery")):d(window.jQuery)})(function(d){d.extend(d.summernote.plugins,{"add-text-tags":function(g){var c=this,f=d.summernote.ui,h=g.options;c.generateBtn=function(a,e){var b=a.slice(0,1).toUpperCase();return f.button({contents:"<"+a+">"+b+"</"+a+">",tooltip:e+" <"+a+">",className:"note-add-text-tags-btn",click:function(b){c.wrapInTag(a)}})};var k=c.generateBtn("del","Deleted text"),l=c.generateBtn("ins","Inserted text"),m=c.generateBtn("small","Fine print"),n=c.generateBtn("mark","Highlighted text"),p=c.generateBtn("var","Variable"),q=c.generateBtn("kbd","User input"),r=c.generateBtn("code","Inline code"),t=c.generateBtn("samp","Sample output");g.memo("button.add-text-tags",function(){return f.buttonGroup([f.button({className:"dropdown-toggle",contents:"<b>+</b> "+f.icon(h.icons.caret,"span"),tooltip:"Additional text styles",data:{toggle:"dropdown"}}),f.dropdown([f.buttonGroup({className:"note-add-text-tags-code",children:[r,t,q,p]}),f.buttonGroup({className:"note-add-text-tags-other",children:[n,m,l,k]})])]).render()});c.areDifferentBlockElements=function(a,c){var b=getComputedStyle(a,null).display,e=getComputedStyle(c,null).display;return"inline"!==b&&"inline"!==e?(console.log("Can't insert across two block elements."),!0):!1};c.isSelectionParsable=function(a,e){if(a.isSameNode(e))return!0;if(c.areDifferentBlockElements(a,e))return!1;var b=a.parentElement,d=e.parentElement;if(a.isSameNode(d)||e.isSameNode(b)||b.isSameNode(d))return!0;console.log("Unable to parse across so many nodes. Sorry!");return!1};c.wrapInTag=function(a){if(window.getSelection){var e=window.getSelection(),b=0<e.rangeCount&&e.getRangeAt(0);if(b.startOffset!==b.endOffset){b=b.cloneRange();var d=b.startContainer.parentElement,f=b.endContainer.parentElement;if(d.isSameNode(f)||c.isSelectionParsable(d,f))a=document.createElement(a),a.appendChild(b.extractContents()),b.insertNode(a),b.selectNodeContents(a),e.removeAllRanges(),e.addRange(b)}}}}})});
        // custom classes
        (function(c){"function"===typeof define&&define.amd?define(["jquery"],c):"object"===typeof module&&module.exports?module.exports=c(require("jquery")):c(window.jQuery)})(function(c){c.extend(c.summernote.plugins,{addclass:function(b){"undefined"===typeof b.options.addclass&&(b.options.addclass={});"undefined"===typeof b.options.addclass.classTags&&(b.options.addclass.classTags="btn;hoverable;flow-text".split(";"));var d=c.summernote.ui;(function(a){var b=document.createElement("style");b.innerHTML=a;document.body.appendChild(b)})(".scrollable-menu {height: auto; max-height: 200px; max-width:300px; overflow-x: hidden;}");b.memo("button.addclass",function(){return d.buttonGroup([d.button({className:"dropdown-toggle",contents:'<i class="fa fa-css3"/> '+d.icon(b.options.icons.caret,"span"),tooltip:"toggle CSS class",data:{toggle:"dropdown"}}),d.dropdown({className:"dropdown-style scrollable-menu",items:b.options.addclass.classTags,template:function(a){"string"===typeof a&&(a={tag:"div",title:a,value:a});var b=a.tag;return"<"+b+" "+(a.style?' style="'+a.style+'" ':"")+(a.value?' class="'+a.value+'" ':"")+">"+a.title+"</"+b+">"},click:function(a,d,e){a.preventDefault();e=e||c(a.target).closest("[data-value]").data("value");a=c(b.invoke("restoreTarget"));0==a.length&&(a=c(document.getSelection().focusNode.parentElement,".note-editable"));"undefined"!==typeof b.options.addclass&&"undefined"!==typeof b.options.addclass.debug&&b.options.addclass.debug&&console.debug(b.invoke("restoreTarget"),a,"toggling class: "+e,window.getSelection());a.toggleClass(e)}})]).render()});this.events={"summernote.init":function(a,b){},"summernote.keyup":function(a,b){}};this.initialize=function(){};this.destroy=function(){}}})});
      });

      // admin UI bindings
      w.GSC.init.push(function () {
        w.GSC.names.push("admin UI bindings");

        // motýle :)
        if (getCookie("motyle") === "false" || !getCookie("motyle")) $("#admin_main").show(100);
        $(".motyle").click(function() {
          $("#admin_main").toggle(200, function () {
            window.scrollTo(0, 0);
            setCookie("motyle", $("#admin_main").is(":hidden"));
          })
        });

        // setup profiles
        var profiles = [];
        var params = new window.URLSearchParams(window.location.search);
        var profile = params.get("profile");
        for (var i in GSC.data.multisite_profiles) profiles.push(i);
        if (!profiles.includes(profile)) {
          profile = getCookie("profile");
          if (!profiles.includes(profile)) {
            profile = "default";
          }
        }
        GSC.profile = profile;
        setCookie("profile", profile);

        $("#SiteSelect option[value=" + profile + "]").prop("selected", true);
        $("#SiteSelect").formSelect();
        $("#domains").html(GSC.data.multisite_profiles[profile].join(" "));

        // web profile selector
        $("#SiteSelect").change(function () {
          if (!$("#SiteSelect").val()) return;
          var profile = $("#SiteSelect").val().trim();
          setCookie("profile", profile);
          window.location.href = window.location.pathname + "?profile=" + profile;
        });

        // remote function selector
        $("#RemoteFnSelect").change(function () {
          if (w.GSC.offline) { // offline
            M.toast({html: "offline 📶"});
            return GSC.PingDot("#sectok_ping", false);
          }
          if (!$("#RemoteFnSelect").val()) return;

          // API: GetUpdateToken
          $.get("/admin/GetUpdateToken?" + Date.now(), function (data) {
            var s = $("#RemoteFnSelect").val();
            var t = data.data[0];
            t = t.replace(/[a-zA-Z]*\?/, s + "?");
            GSC.CopyClipboard(t);
            GSC.PingDot("#sectok_ping");
            M.toast({html: s + " {{ l.a_remotecode }}: {{ l.a_clipboardcopy }}"});
          }).fail(function () {
            $("#a_security_token").val("N/A");
            GSC.PingDot("#sectok_ping", false);
            GSC.CopyClipboard("");
            M.toast({html: s + " ERROR 🤯"});
          });
        });

        // update CSV data
        $("#a_update").click(function () {
          if (w.GSC.offline) { // offline
            M.toast({html: "offline 📶"});
            return GSC.PingDot("#csv_ping", false);
          }
          $("#a_update").attr("disabled", "disabled");
          GSC.ShowLoader("#a_update_info");
          setTimeout(function () {
            $("#a_update").removeAttr("disabled");
          }, 30E3);

          // API: CoreUpdate
          $.post("/admin/CoreUpdate");
        });

        // show Google PSI
        $("#a_ps_insights").click(function () {
          if (w.GSC.offline) { // offline
            M.toast({html: "offline 📶"});
            return GSC.PingDot("#psi_ping", false);
          }
          $("#a_ps_insights").attr("disabled", "disabled");
          GSC.PingDot("#psi_ping");
          GSC.GetPSInsights();
        });

        // invoke Summernote editor
        $("#a_summernote").click(function () {
          if (w.GSC.offline) { // offline
            M.toast({html: "offline 📶"});
            return GSC.PingDot("#psi_ping", false);
          }
          GSC.ReadArticles(function () {
            GSC.DeploySummernote();
          });
        });

        // toggle emoji panel
        $("#a_emoji").click(function () {
          if (!GSC.emojicc) {
            var splitter = new GraphemeSplitter();
            var graphemes = splitter.splitGraphemes($("#emojis").text());
            var arr = graphemes.map(function (x) {
              return '<span class="ccemoji">' + x + '</span>';
            });
            $("#emojis").html(arr.join(""));
            $(".ccemoji").click(function () {
              var x = $(this).text();
              GSC.CopyClipboard(x);
              M.toast({html: x, classes: "bigemoji"});
            });
            GSC.emojicc = true;
          }
          $("#emojis").toggle("fast");
        });

        // flush cache
        $("#a_flush").click(function () {
          if (w.GSC.offline) { // offline
            M.toast({html: "offline 📶"});
            return GSC.PingDot("#csv_ping", false);
          }
          GSC.GetCsvInfo = function () {};
          $("#a_flush").attr("disabled", "disabled");

          // API: FlushCache
          $.post("/admin/FlushCache");
          window.location.reload(true);
        });

        // get auth code
        $("#a_getcode").click(function () {
          if (w.GSC.offline) { // offline
            M.toast({html: "offline 📶"});
            return GSC.PingDot("#csv_ping", false);
          }

          // API: CreateAuthCode
          $.post("/admin/CreateAuthCode", function(data) {
            GSC.CopyClipboard(data.data.hash);
            M.toast({html: "CreateAuthCode {{ l.a_clipboardcopy }} [" + data.data.hash + "] 🆗"});
          });
        });

        // delete auth code
        $("#a_delcode").click(function () {
          if (w.GSC.offline) { // offline
            M.toast({html: "offline 📶"});
            return GSC.PingDot("#csv_ping", false);
          }

          // API: DeleteAuthCode
          $.post("/admin/DeleteAuthCode", function(data) {
            M.toast({html: "DeleteAuthCode {{ l.a_codedeleted }} 🆗"});
            GSC.CopyClipboard("");
          });
        });

        $("#a_logout").click(function () {
          setCookie("logout", "logout", 0);
          GSC.offline ? window.location.replace("/") : window.location.replace("/logout");
        });

      });

      // CSV info timer
      w.GSC.init.push(function () {
        w.GSC.names.push("CSV timer");
        if (!w.GSC.offline) GSC.ShowLoader("#a_update_info");
        setInterval(function() {
          window.GSC.GetCsvInfo();
        }, 5000);
        GSC.GetCsvInfo();
      });

      // show admin UI
      w.GSC.init.push(function () {
        w.GSC.names.push("Admin UI");
        GSC.AdminUI();
      });

      // load PSI into cache
      w.GSC.init.push(function () {
        w.GSC.names.push("Update PSI cache");

        // API: GetPSInsights
        $.get("/admin/GetPSInsights?" + Date.now());
      });

    }
  })(window, document);

</script>

<!-- SUMMERNOTE editor //-->
<script src="{{ cdn }}/summernote/summernote-lite.js" defer></script>
{{#langcs}}<script src="{{ cdn }}/summernote/lang/summernote-cs-CZ.min.js" defer></script>{{/langcs}}
<link href="{{ cdn }}/summernote/summernote-lite.css" rel="stylesheet">

<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/codemirror.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/theme/material.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/codemirror.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/mode/xml/xml.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/mode/htmlmixed/htmlmixed.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/addon/lint/html-lint.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.1/addon/hint/html-hint.min.js" defer></script>

<script src="{{ cdn }}/js/moment.min.js" defer></script>
<script src="{{ cdn }}/js/grapheme.min.js" defer></script>

{{/admin_group_admin}}
