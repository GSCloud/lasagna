<a class="webshare" aria-hidden="true" style="display:none;font-size:1.2em;width:100%"><i
    class="fas fa-share-alt-square"></i>&nbsp;{{ l.webshare_button }}</a>
<script>
  if ("ontouchstart" in window || window.DocumentTouch && document instanceof DocumentTouch) {
    if (navigator.share) {

      if (typeof window.WebShare !== "function") window.WebShare = function (text, url, title) {
        if (!text) text = "";
        if (!url) url = "";
        if (!title) title = "";
        var title = title.length ? title : document.title;
        var text = text.length ? text : document.title;
        var url = url.length ? url : (document.querySelector("link[rel=canonical]") ?
          document.querySelector("link[rel=canonical]").href : document.location.href);
        console.log("WebShare API: ",{title, text, url});
        navigator.share({
          text: text,
          url: url,
          title: title,
        }).catch(console.error);
      }

      if (typeof window.WebShareFactory !== "function") window.WebShareFactory = function (text, url, title) {
        if (!text) text = "";
        if (!url) url = "";
        if (!title) title = "";
        text = text.replace(new RegExp(/['\"\n\r]*/, "g"), "");
        url = url.replace(new RegExp(/['\"\n\r\s]*/, "g"), "");
        title = title.replace(new RegExp(/['\"\n\r]*/, "g"), "");
        var el =
          '<a onclick="var that = this;this.style.transition = \'filter 0s\';this.style.filter = \'invert(100%)\';' +
          'setTimeout(function () {that.style.transition = \'all 2s\';that.style.filter = \'\';}, 1);window.WebShare(\'' +
          text + '\', \'' + url + '\', \'' + title + '\')" aria-hidden="true" style="display:inline-block;margin:8px">' +
          '<i class="fas fa-share-alt-square"></i></a>';
        return el;
      }

      var el = document.getElementsByClassName("webshare");
      for (var i = 0; i < el.length; i++) {
        el[i].style.display = "block";
        el[i].addEventListener("click", function () {
          var that = this;
          this.style.transition = "filter 0s";
          this.style.filter = "invert(100%)";
          setTimeout(function () {
            that.style.transition = "all 2s";
            that.style.filter = "";
          }, 1);
          window.WebShare();
        });
      }
    };
  }

</script>
